<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà 2569</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: backgroundMove 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes backgroundMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        @media (max-width: 768px) { 
            body { padding: 10px; }
            
            .header h1 { 
                font-size: 22px;
                line-height: 1.4;
            }
            
            .header::before { 
                font-size: 40px;
                margin-bottom: 12px;
            }
            
            .holiday-badge { 
                font-size: 13px;
                padding: 8px 18px;
            }
            
            label {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            input[type="text"], input[type="number"], input[type="date"], select {
                font-size: 14px;
                padding: 12px 14px;
            }
            
            .radio-option {
                padding: 12px 16px;
                min-width: 110px;
            }
            
            .radio-option label {
                font-size: 14px;
            }
            
            .search-btn {
                font-size: 14px;
                padding: 12px 16px;
            }
            
            .btn {
                font-size: 16px;
                padding: 16px;
            }
            
            .help-text {
                font-size: 12px;
            }
            
            .info-label, .info-value {
                font-size: 14px;
            }
            
            .duplicate-modal h2, .success-modal h2 {
                font-size: 22px;
            }
            
            .duplicate-icon, .success-icon {
                font-size: 60px;
            }
            
            .summary-label, .summary-value {
                font-size: 14px;
            }
            
            .blessing {
                font-size: 15px;
                padding: 18px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 { 
                font-size: 20px;
            }
            
            .header::before { 
                font-size: 35px;
            }
            
            .holiday-badge { 
                font-size: 12px;
                padding: 7px 15px;
            }
            
            label {
                font-size: 13px;
            }
            
            input[type="text"], input[type="number"], input[type="date"], select {
                font-size: 13px;
                padding: 11px 13px;
            }
            
            .radio-option {
                padding: 10px 14px;
            }
            
            .radio-option label {
                font-size: 13px;
            }
            
            .radio-option input[type="radio"] {
                width: 18px;
                height: 18px;
            }
            
            .search-btn {
                font-size: 13px;
                padding: 11px 14px;
            }
            
            .dropdown-btn {
                font-size: 16px;
                padding: 12px 16px;
                min-width: 45px;
            }
            
            .btn {
                font-size: 15px;
                padding: 14px;
            }
            
            .help-text {
                font-size: 11px;
            }
            
            .info-label, .info-value {
                font-size: 13px;
            }
            
            .duplicate-modal, .success-modal {
                padding: 25px 20px;
            }
            
            .duplicate-modal h2, .success-modal h2 {
                font-size: 20px;
            }
            
            .duplicate-icon, .success-icon {
                font-size: 50px;
            }
            
            .duplicate-info, .summary-box {
                padding: 16px;
            }
            
            .duplicate-info-label, .duplicate-info-value {
                font-size: 13px;
            }
            
            .summary-label, .summary-value {
                font-size: 13px;
            }
            
            .blessing {
                font-size: 14px;
                padding: 16px;
                line-height: 1.6;
            }
            
            .close-modal-btn {
                font-size: 14px;
                padding: 13px 30px;
            }
            
            .duplicate-btn {
                font-size: 14px;
                padding: 12px;
                min-width: 110px;
            }
            
            .province-suggestion-item {
                font-size: 14px;
                padding: 12px 16px;
            }
        }
        
        @media (max-width: 360px) {
            .container {
                padding: 20px 15px;
            }
            
            .header h1 { 
                font-size: 18px;
            }
            
            .header::before { 
                font-size: 30px;
            }
            
            .holiday-badge { 
                font-size: 11px;
                padding: 6px 12px;
            }
            
            label {
                font-size: 12px;
            }
            
            input[type="text"], input[type="number"], input[type="date"], select {
                font-size: 12px;
                padding: 10px 12px;
            }
            
            .radio-option label {
                font-size: 12px;
            }
            
            .btn {
                font-size: 14px;
            }
        }
        
        @keyframes slideDown { 
            from { opacity: 0; transform: translateY(-30px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .container { 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 30px; 
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.37),
                0 30px 80px rgba(0,0,0,0.2),
                inset 0 0 0 1px rgba(255,255,255,0.5);
            max-width: 650px; 
            width: 100%; 
            padding: 35px; 
            border: 1px solid rgba(255, 255, 255, 0.3);
            max-height: 90vh; 
            overflow-y: auto;
            position: relative;
            animation: fadeIn 0.6s ease-out;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
            border-radius: 30px 30px 0 0;
        }
        
        @keyframes shimmer {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }
        
        @media (max-width: 768px) { 
            .container { padding: 25px 20px; border-radius: 25px; margin: 10px; max-height: 95vh; } 
        }
        
        .header { 
            text-align: center; 
            margin-bottom: 35px;
            position: relative;
        }
        
        .header::before { 
            content: '‚úàÔ∏èüéâüåü'; 
            font-size: 50px; 
            display: block; 
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
        }
        
        .header h1 { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
            font-size: 28px; 
            font-weight: 800; 
            margin-bottom: 15px; 
            line-height: 1.3;
            text-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
            animation: slideDown 0.6s ease-out;
        }
        
        .holiday-badge { 
            display: inline-block; 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white; 
            padding: 10px 25px; 
            border-radius: 25px; 
            font-size: 15px; 
            font-weight: 700; 
            margin-top: 10px; 
            box-shadow: 
                0 8px 20px rgba(245, 87, 108, 0.4),
                0 4px 10px rgba(240, 147, 251, 0.3);
            animation: float 3s ease-in-out infinite;
            animation-delay: 0.5s;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .form-group { 
            margin-bottom: 25px;
            animation: slideDown 0.4s ease-out;
        }
        
        .form-section { 
            display: none; 
        }
        
        .form-section.show { 
            display: block; 
            animation: slideDown 0.5s ease-out; 
        }
        
        .radio-group { 
            display: flex; 
            gap: 15px; 
            margin-top: 12px; 
            flex-wrap: wrap; 
        }
        
        .radio-option { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 14px 22px; 
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px; 
            cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            flex: 1; 
            min-width: 130px;
            position: relative;
            overflow: hidden;
        }
        
        .radio-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .radio-option:hover::before {
            left: 100%;
        }
        
        @media (max-width: 480px) { 
            .radio-option { flex: 1 1 100%; justify-content: center; } 
        }
        
        .radio-option:hover { 
            border-color: #667eea;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            background: rgba(102, 126, 234, 0.05);
        }
        
        .radio-option input[type="radio"] { 
            width: 22px; 
            height: 22px; 
            cursor: pointer; 
            accent-color: #667eea;
        }
        
        .radio-option label { 
            margin: 0; 
            cursor: pointer; 
            font-size: 16px; 
            flex: 1;
            font-weight: 600;
            color: #4a5568;
            word-break: keep-all;
            white-space: normal;
            line-height: 1.4;
        }
        
        .radio-option input[type="radio"]:checked + label { 
            color: #667eea;
            font-weight: 800; 
        }
        
        .radio-option:has(input[type="radio"]:checked) { 
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.1));
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.3),
                inset 0 0 20px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        .province-search-wrapper { 
            position: relative; 
        }
        
        .province-input-group { 
            display: flex; 
            gap: 10px; 
            align-items: stretch; 
        }
        
        .province-input-group input { 
            flex: 1; 
        }
        
        .dropdown-btn { 
            padding: 14px 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border: none; 
            border-radius: 15px; 
            font-size: 18px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            min-width: 50px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .dropdown-btn:hover { 
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }
        
        .dropdown-btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .province-suggestions { 
            position: absolute; 
            top: 100%; 
            left: 0; 
            right: 0; 
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-top: none; 
            border-radius: 0 0 15px 15px; 
            max-height: 280px; 
            overflow-y: auto; 
            display: none; 
            z-index: 100; 
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.5);
            margin-top: 2px;
            animation: slideDown 0.3s ease-out;
        }
        
        .province-suggestions.show { 
            display: block; 
        }
        
        .province-suggestion-item { 
            padding: 14px 20px; 
            cursor: pointer; 
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            font-weight: 600;
            color: #4a5568;
        }
        
        .province-suggestion-item:hover { 
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.05));
            padding-left: 25px;
            color: #667eea;
        }
        
        .province-other-input { 
            margin-top: 12px; 
            display: none; 
        }
        
        .province-other-input.show { 
            display: block; 
            animation: slideDown 0.3s ease-out; 
        }
        
        label { 
            display: block; 
            font-weight: 700; 
            color: #2d3748;
            margin-bottom: 12px; 
            font-size: 16px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        label::before { 
            content: 'üéØ '; 
        }
        
        .required { 
            color: #f5576c;
            font-weight: 800;
        }
        
        input[type="text"], input[type="number"], input[type="date"], select { 
            width: 100%; 
            padding: 14px 18px; 
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px; 
            font-size: 15px; 
            transition: all 0.3s ease;
            font-family: inherit; 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            font-weight: 600;
            color: #2d3748;
        }
        
        input:focus, select:focus { 
            outline: none; 
            border-color: #667eea;
            background: white;
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.15),
                0 8px 25px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        
        input:disabled, select:disabled { 
            background: rgba(226, 232, 240, 0.5);
            cursor: not-allowed; 
            opacity: 0.6; 
        }
        
        .employee-info { 
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.15) 0%, rgba(56, 178, 172, 0.1) 100%);
            backdrop-filter: blur(10px);
            padding: 22px; 
            border-radius: 20px; 
            margin-top: 15px; 
            display: none; 
            border: 2px solid rgba(72, 187, 120, 0.3);
            box-shadow: 
                0 8px 25px rgba(72, 187, 120, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.5);
        }
        
        .employee-info.show { 
            display: block; 
            animation: slideDown 0.4s ease-out; 
        }
        
        .info-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 2px dashed rgba(72, 187, 120, 0.2);
            gap: 10px;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        
        .info-row:last-child { 
            border-bottom: none; 
        }
        
        .info-label { 
            font-weight: 700; 
            color: #2f855a;
        }
        
        .info-label::before { 
            content: '‚úì '; 
            color: #48bb78;
            font-size: 18px;
        }
        
        .info-value { 
            color: #276749;
            font-weight: 700;
            text-align: right; 
        }
        
        .btn { 
            width: 100%; 
            padding: 18px; 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white; 
            border: none; 
            border-radius: 18px; 
            font-size: 18px; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 20px; 
            box-shadow: 
                0 10px 30px rgba(245, 87, 108, 0.4),
                0 5px 15px rgba(240, 147, 251, 0.3);
            position: relative; 
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn::before { 
            content: ''; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            width: 0; 
            height: 0; 
            border-radius: 50%; 
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%); 
            transition: width 0.6s, height 0.6s; 
        }
        
        .btn:hover::before { 
            width: 400px; 
            height: 400px; 
        }
        
        .btn:hover { 
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 15px 40px rgba(245, 87, 108, 0.5),
                0 8px 20px rgba(240, 147, 251, 0.4);
        }
        
        .btn:active {
            transform: translateY(-2px) scale(1.01);
        }
        
        .btn:disabled { 
            background: linear-gradient(135deg, #cbd5e0, #a0aec0);
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        
        .error { 
            color: #f5576c;
            font-size: 14px; 
            margin-top: 10px; 
            display: none; 
            font-weight: 700;
            background: rgba(245, 87, 108, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            border-left: 4px solid #f5576c;
            animation: shake 0.5s ease-in-out;
        }
        
        .error::before { 
            content: '‚ùå '; 
        }
        
        .error.show { 
            display: block;
        }
        
        .loading { 
            text-align: center; 
            color: #667eea;
            margin-top: 15px; 
            display: none; 
            font-weight: 700;
            animation: pulse 1.5s infinite;
            font-size: 15px;
        }
        
        .loading.show { 
            display: block; 
        }
        
        .modal-overlay { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(5px);
            z-index: 1000; 
            justify-content: center; 
            align-items: center; 
            padding: 10px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-overlay.show { 
            display: flex; 
        }
        
        .duplicate-modal, .success-modal { 
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 30px; 
            padding: 40px; 
            max-width: 600px; 
            width: 90%; 
            text-align: center; 
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.4),
                inset 0 0 0 1px rgba(255,255,255,0.5);
            max-height: 90vh; 
            overflow-y: auto;
            animation: fadeIn 0.4s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .success-modal { 
            max-width: 550px; 
        }
        
        .duplicate-icon, .success-icon { 
            font-size: 80px; 
            margin-bottom: 20px;
            animation: float 2s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
        }
        
        .duplicate-modal h2 { 
            background: linear-gradient(135deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 26px; 
            margin-bottom: 15px; 
            font-weight: 800; 
        }
        
        .success-modal h2 { 
            background: linear-gradient(135deg, #48bb78, #38b2ac);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 26px; 
            margin-bottom: 15px; 
            font-weight: 800; 
        }
        
        .duplicate-info { 
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.05));
            border: 2px solid rgba(240, 147, 251, 0.3);
            border-radius: 20px; 
            padding: 22px; 
            margin: 25px 0; 
            text-align: left;
            backdrop-filter: blur(10px);
            box-shadow: inset 0 2px 10px rgba(240, 147, 251, 0.1);
        }
        
        .duplicate-info-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid rgba(240, 147, 251, 0.2);
            gap: 12px;
            align-items: center;
        }
        
        .duplicate-info-row:last-child { 
            border-bottom: none; 
        }
        
        @media (max-width: 480px) {
            .duplicate-info-row {
                padding: 6px 0;
                gap: 8px;
            }
        }
        
        .duplicate-info-label { 
            font-weight: 700; 
            color: #744210;
        }
        
        .duplicate-info-value { 
            color: #4a5568;
            font-weight: 700;
            text-align: right; 
            word-break: break-word; 
        }
        
        .duplicate-buttons { 
            display: flex; 
            gap: 15px; 
            margin-top: 25px; 
            flex-wrap: wrap; 
        }
        
        .duplicate-btn { 
            flex: 1; 
            padding: 16px; 
            border: none; 
            border-radius: 15px; 
            font-size: 16px; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.3s ease;
            min-width: 140px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn-cancel { 
            background: linear-gradient(135deg, #a0aec0, #718096);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-cancel:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(113, 128, 150, 0.4);
        }
        
        .btn-edit { 
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-edit:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(245, 87, 108, 0.5);
        }
        
        .summary-box { 
            background: linear-gradient(135deg, rgba(237, 242, 247, 0.8), rgba(226, 232, 240, 0.6));
            backdrop-filter: blur(10px);
            border-radius: 20px; 
            padding: 25px; 
            margin: 25px 0; 
            text-align: left; 
            border: 2px solid rgba(102, 126, 234, 0.2);
            box-shadow: inset 0 2px 10px rgba(102, 126, 234, 0.1);
        }
        
        .summary-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid rgba(102, 126, 234, 0.15);
            gap: 12px;
            align-items: center;
        }
        
        .summary-row:last-child { 
            border-bottom: none; 
        }
        
        @media (max-width: 480px) {
            .summary-row {
                padding: 6px 0;
                gap: 8px;
            }
        }
        
        .summary-label { 
            font-weight: 700; 
            color: #2d3748;
        }
        
        .summary-value { 
            color: #4a5568;
            font-weight: 700;
            text-align: right; 
            word-break: break-word; 
        }
        
        .blessing { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 22px; 
            border-radius: 20px; 
            margin-top: 25px; 
            font-size: 17px; 
            font-weight: 700; 
            line-height: 1.8;
            box-shadow: 
                0 10px 30px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .close-modal-btn { 
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white; 
            border: none; 
            padding: 16px 40px; 
            border-radius: 15px; 
            font-size: 16px; 
            font-weight: 800; 
            cursor: pointer; 
            margin-top: 25px; 
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .close-modal-btn:hover { 
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(79, 172, 254, 0.5);
        }
        
        .help-text { 
            font-size: 13px; 
            color: #718096;
            margin-top: 8px;
            font-weight: 600;
            font-style: italic;
        }
        
        .help-text::before { 
            content: '‚ÑπÔ∏è '; 
        }
        
        .search-btn { 
            padding: 14px 22px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border: none; 
            border-radius: 15px; 
            font-size: 15px; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .search-btn:hover { 
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }
        
        .other-input { 
            margin-top: 12px; 
            display: none; 
        }
        
        .other-input.show { 
            display: block; 
            animation: slideDown 0.3s ease-out; 
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2, #f093fb);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà</h1>
            <div class="holiday-badge">27 ‡∏ò.‡∏Ñ. 68 - 4 ‡∏°.‡∏Ñ. 69</div>
        </div>

        <form id="travelForm">
            <div class="form-group">
                <label for="employeeId">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="employeeId" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" style="flex: 1;" autocomplete="off">
                    <button type="button" id="searchBtn" class="search-btn">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
                <div class="error" id="employeeIdError"></div>
                <div class="loading" id="employeeLoading">üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            </div>

            <div class="employee-info" id="employeeInfo">
                <div class="info-row"><span class="info-label">‡∏ù‡πà‡∏≤‡∏¢</span><span class="info-value" id="division">-</span></div>
                <div class="info-row"><span class="info-label">‡πÅ‡∏ú‡∏ô‡∏Å</span><span class="info-value" id="department">-</span></div>
                <div class="info-row"><span class="info-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô</span><span class="info-value" id="workgroup">-</span></div>
            </div>

            <div class="form-section" id="restOfForm">
                <div class="form-group">
                    <label>‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 27 ‡∏ò.‡∏Ñ. 68 - 4 ‡∏°.‡∏Ñ. 69 <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-option"><input type="radio" id="travelYes" name="travelStatus" value="‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á" required><label for="travelYes">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label></div>
                        <div class="radio-option"><input type="radio" id="travelNo" name="travelStatus" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á" required><label for="travelNo">üè† ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label></div>
                    </div>
                </div>

                <div class="form-group" id="provinceGroup">
                    <label for="provinceInput">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ <span class="required">*</span></label>
                    <div class="province-search-wrapper">
                        <div class="province-input-group">
                            <input type="text" id="provinceInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å ‚ñº ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®..." autocomplete="off">
                            <button type="button" class="dropdown-btn" id="provinceDropdownBtn" title="‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">‚ñº</button>
                        </div>
                        <div class="province-suggestions" id="provinceSuggestions"></div>
                    </div>
                    <input type="text" id="provinceOther" class="province-other-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏≠‡∏∑‡πà‡∏ô‡πÜ">
                    <input type="hidden" id="provinceValue">
                </div>

                <div class="form-group">
                    <label for="departureDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ <span class="required">*</span></label>
                    <input type="date" id="departureDate" min="2025-12-24" max="2026-01-04">
                    <p class="help-text">‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 27 ‡∏ò.‡∏Ñ. 68 - 4 ‡∏°.‡∏Ñ. 69</p>
                </div>

                <div class="form-group">
                    <label for="returnDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö <span class="required">*</span></label>
                    <input type="date" id="returnDate" min="2025-12-27" max="2026-01-07">
                    <div class="error" id="dateError"></div>
                    <p class="help-text" id="travelDays" style="display: none; color: #27ae60; font-weight: 600; margin-top: 10px;"></p>
                </div>

                <div class="form-group">
                    <label for="companion">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á <span class="required">*</span></label>
                    <select id="companion">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>
                        <option value="‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">üë§ ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option>
                        <option value="‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</option>
                        <option value="‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô">üë• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üîÑ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                    <input type="text" id="companionOther" class="other-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ">
                </div>

                <div class="form-group">
                    <label for="travelers">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á <span class="required">*</span></label>
                    <input type="number" id="travelers" min="1" max="20" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô">
                    <p class="help-text">‡∏£‡∏ß‡∏°‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢</p>
                </div>

                <div class="form-group" id="vehicleGroup">
                    <label for="vehicle">‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á <span class="required">*</span></label>
                    <select id="vehicle">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏≤‡∏´‡∏ô‡∏∞ --</option>
                        <option value="‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">üöó ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                        <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">üèçÔ∏è ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                        <option value="‡∏£‡∏ñ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞">üöå ‡∏£‡∏ñ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</option>
                        <option value="‡∏£‡∏ñ‡πÑ‡∏ü">üöÜ ‡∏£‡∏ñ‡πÑ‡∏ü</option>
                        <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô">‚úàÔ∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô</option>
                    </select>
                </div>

                <div class="form-group" id="leaveBeforeGroup">
                    <label>‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î <span class="required">*</span></label>
                    <div class="radio-group" style="flex-direction: column; gap: 10px;">
                        <div class="radio-option"><input type="radio" id="leaveBefore0" name="leaveBefore" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≤" required><label for="leaveBefore0">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≤</label></div>
                        <div class="radio-option"><input type="radio" id="leaveBefore1" name="leaveBefore" value="‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô (26 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568)" required><label for="leaveBefore1">‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô<br><small style="color: #7f8c8d;">(26 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568)</small></label></div>
                        <div class="radio-option"><input type="radio" id="leaveBefore2" name="leaveBefore" value="‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 2 ‡∏ß‡∏±‡∏ô (25-26 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568)" required><label for="leaveBefore2">‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 2 ‡∏ß‡∏±‡∏ô<br><small style="color: #7f8c8d;">(25-26 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568)</small></label></div>
                    </div>
                </div>

                <div class="form-group" id="leaveAfterGroup">
                    <label>‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î <span class="required">*</span></label>
                    <div class="radio-group" style="flex-direction: column; gap: 10px;">
                        <div class="radio-option"><input type="radio" id="leaveAfter0" name="leaveAfter" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≤" required><label for="leaveAfter0">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≤</label></div>
                        <div class="radio-option"><input type="radio" id="leaveAfter1" name="leaveAfter" value="‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô (5 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569)" required><label for="leaveAfter1">‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô<br><small style="color: #7f8c8d;">(5 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569)</small></label></div>
                        <div class="radio-option"><input type="radio" id="leaveAfter2" name="leaveAfter" value="‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 2 ‡∏ß‡∏±‡∏ô (5-6 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569)" required><label for="leaveAfter2">‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 2 ‡∏ß‡∏±‡∏ô<br><small style="color: #7f8c8d;">(5-6 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569)</small></label></div>
                    </div>
                </div>

                <button type="submit" class="btn" id="submitBtn"><span style="position: relative; z-index: 1;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span></button>
            </div>
        </form>
    </div>

    <div class="modal-overlay" id="duplicateModal">
        <div class="duplicate-modal">
            <div class="duplicate-icon">‚ö†Ô∏è</div>
            <h2>‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <p style="color: #666; margin-bottom: 20px;">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
            <div class="duplicate-info" id="duplicateInfo"></div>
            <div class="duplicate-buttons">
                <button class="duplicate-btn btn-cancel" onclick="cancelEdit()">‚ùå ‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button class="duplicate-btn btn-edit" onclick="confirmEdit()">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="success-modal">
            <div class="success-icon">‚úÖüéâ</div>
            <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
            <div class="summary-box" id="summaryBox"></div>
            <div class="blessing">‚ú® ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏†‡∏≤‡∏û ‚ú®<br>üåü Bon Voyage! üåü<br>üéä Happy New Year! üéä</div>
            <button class="close-modal-btn" onclick="closeModalAndReset()">üéØ ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>

    <script>
        const CONFIG = { WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbwvHfBYBgLS_Nl1S3CkzPv8Cyc8-L0W4qLqnDCDmohEt1Vph7xmyunLYOB3QIx04Qp4/exec' };
        let employeeData = null, existingData = null, shouldDeleteOldData = false;
        const provinces = ['‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£', '‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ', '‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£', '‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°', '‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà', '‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', '‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå', '‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£', '‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô', '‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ', '‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤', '‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ', '‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó', '‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥', '‡∏ä‡∏∏‡∏°‡∏û‡∏£', '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢', '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', '‡∏ï‡∏£‡∏±‡∏á', '‡∏ï‡∏£‡∏≤‡∏î', '‡∏ï‡∏≤‡∏Å', '‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å', '‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°', '‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤', '‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä', '‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå', '‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™', '‡∏ô‡πà‡∏≤‡∏ô', '‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨', '‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå', '‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå', '‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', '‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ', '‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤', '‡∏û‡∏∞‡πÄ‡∏¢‡∏≤', '‡∏û‡∏±‡∏á‡∏á‡∏≤', '‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á', '‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£', '‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å', '‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ', '‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå', '‡πÅ‡∏û‡∏£‡πà', '‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï', '‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°', '‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£', '‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô', '‡∏¢‡πÇ‡∏™‡∏ò‡∏£', '‡∏¢‡∏∞‡∏•‡∏≤', '‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î', '‡∏£‡∏∞‡∏ô‡∏≠‡∏á', '‡∏£‡∏∞‡∏¢‡∏≠‡∏á', '‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ', '‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ', '‡∏•‡∏≥‡∏õ‡∏≤‡∏á', '‡∏•‡∏≥‡∏û‡∏π‡∏ô', '‡πÄ‡∏•‡∏¢', '‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©', '‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£', '‡∏™‡∏á‡∏Ç‡∏•‡∏≤', '‡∏™‡∏ï‡∏π‡∏•', '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°', '‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß', '‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ', '‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ', '‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢', '‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ', '‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå', '‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢', '‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π', '‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á', '‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç', '‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå', '‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ', '‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ', 'üá®üá≥ ‡∏à‡∏µ‡∏ô', 'üáØüáµ ‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô', 'üá∞üá∑ ‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ‡πÉ‡∏ï‡πâ', 'üá∞üá≠ ‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤', 'üá±üá¶ ‡∏•‡∏≤‡∏ß', 'üá≤üá≤ ‡∏û‡∏°‡πà‡∏≤', 'üá≤üáæ ‡∏°‡∏≤‡πÄ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢', 'üá∏üá¨ ‡∏™‡∏¥‡∏á‡∏Ñ‡πÇ‡∏õ‡∏£‡πå', 'üáªüá≥ ‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'];

        async function searchEmployee() {
            const employeeIdInput = document.getElementById('employeeId');
            const employeeId = employeeIdInput.value.trim().toUpperCase();
            const errorDiv = document.getElementById('employeeIdError');
            const loadingDiv = document.getElementById('employeeLoading');
            const infoDiv = document.getElementById('employeeInfo');
            const restOfForm = document.getElementById('restOfForm');

            if (!employeeId) { 
                errorDiv.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'; 
                errorDiv.classList.add('show'); 
                infoDiv.classList.remove('show'); 
                restOfForm.classList.remove('show'); 
                return; 
            }

            loadingDiv.classList.add('show'); 
            errorDiv.classList.remove('show'); 
            infoDiv.classList.remove('show'); 
            restOfForm.classList.remove('show');

            try {
                const response = await fetch(`${CONFIG.WEB_APP_URL}?action=searchEmployee&employeeId=${encodeURIComponent(employeeId)}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.json();
                
                loadingDiv.classList.remove('show');
                
                if (result.status === 'success' && result.data && result.data.employee) {
                    const employee = result.data.employee;
                    employeeData = employee;
                    employeeIdInput.value = employeeId;
                    
                    if (result.data.hasDuplicate && result.data.duplicateData) { 
                        existingData = result.data.duplicateData;
                        showDuplicateModal(existingData); 
                    } else { 
                        document.getElementById('division').textContent = employee.division; 
                        document.getElementById('department').textContent = employee.department; 
                        document.getElementById('workgroup').textContent = employee.workgroup; 
                        infoDiv.classList.add('show'); 
                        setTimeout(() => restOfForm.classList.add('show'), 300); 
                    }
                } else { 
                    errorDiv.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö'; 
                    errorDiv.classList.add('show'); 
                    employeeData = null; 
                }
            } catch (error) { 
                loadingDiv.classList.remove('show'); 
                errorDiv.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message; 
                errorDiv.classList.add('show'); 
            }
        }

        function showDuplicateModal(data) {
            const duplicateInfo = document.getElementById('duplicateInfo');
            
            // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
            const isMobile = window.innerWidth <= 480;
            const leaveBeforeLabel = isMobile ? 'üìÖ ‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô:' : 'üìÖ ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î:';
            const leaveAfterLabel = isMobile ? 'üìÖ ‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á:' : 'üìÖ ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î:';
            
            let infoHTML = `<div class="duplicate-info-row"><span class="duplicate-info-label">‚è∞ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å:</span><span class="duplicate-info-value">${formatThaiDateTime(data.timestamp)}</span></div><div class="duplicate-info-row"><span class="duplicate-info-label">üë§ ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</span><span class="duplicate-info-value">${data.employeeId}</span></div><div class="duplicate-info-row"><span class="duplicate-info-label">üöó ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span><span class="duplicate-info-value">${data.travelStatus}</span></div>`;
            if (data.travelStatus === '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á') {
                infoHTML += `<div class="duplicate-info-row"><span class="duplicate-info-label">üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®:</span><span class="duplicate-info-value">${data.province}</span></div><div class="duplicate-info-row"><span class="duplicate-info-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ:</span><span class="duplicate-info-value">${formatThaiDate(data.departureDate)}</span></div><div class="duplicate-info-row"><span class="duplicate-info-label">üîô ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏±‡∏ö:</span><span class="duplicate-info-value">${formatThaiDate(data.returnDate)}</span></div><div class="duplicate-info-row"><span class="duplicate-info-label">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô:</span><span class="duplicate-info-value">${data.travelers} ‡∏Ñ‡∏ô</span></div>`;
            }
            infoHTML += `<div class="duplicate-info-row"><span class="duplicate-info-label">${leaveBeforeLabel}</span><span class="duplicate-info-value">${data.leaveBefore || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≤'}</span></div><div class="duplicate-info-row"><span class="duplicate-info-label">${leaveAfterLabel}</span><span class="duplicate-info-value">${data.leaveAfter || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏≤'}</span></div>`;
            duplicateInfo.innerHTML = infoHTML; 
            document.getElementById('duplicateModal').classList.add('show');
        }

        function cancelEdit() { 
            document.getElementById('duplicateModal').classList.remove('show'); 
            document.getElementById('travelForm').reset(); 
            document.getElementById('employeeInfo').classList.remove('show'); 
            document.getElementById('restOfForm').classList.remove('show'); 
            employeeData = null; 
            existingData = null; 
            shouldDeleteOldData = false; 
            document.getElementById('employeeId').focus(); 
        }

        function confirmEdit() { 
            document.getElementById('duplicateModal').classList.remove('show'); 
            shouldDeleteOldData = true; 
            document.getElementById('division').textContent = employeeData.division; 
            document.getElementById('department').textContent = employeeData.department; 
            document.getElementById('workgroup').textContent = employeeData.workgroup; 
            document.getElementById('employeeInfo').classList.add('show'); 
            setTimeout(() => document.getElementById('restOfForm').classList.add('show'), 300); 
        }

        document.getElementById('searchBtn').addEventListener('click', searchEmployee);
        document.getElementById('employeeId').addEventListener('keypress', function(e) { 
            if (e.key === 'Enter') { 
                e.preventDefault(); 
                searchEmployee(); 
            } 
        });

        const provinceInput = document.getElementById('provinceInput');
        const provinceSuggestions = document.getElementById('provinceSuggestions');
        const provinceValue = document.getElementById('provinceValue');
        const provinceOther = document.getElementById('provinceOther');
        const provinceDropdownBtn = document.getElementById('provinceDropdownBtn');

        provinceDropdownBtn.addEventListener('click', function(e) { 
            e.stopPropagation(); 
            if (provinceSuggestions.classList.contains('show')) {
                provinceSuggestions.classList.remove('show'); 
            } else { 
                showAllProvinces(); 
                provinceInput.focus(); 
            } 
        });

        provinceInput.addEventListener('focus', function() { 
            if (!this.value.trim()) showAllProvinces(); 
        });

        function showAllProvinces() { 
            provinceSuggestions.innerHTML = provinces.map(p => `<div class="province-suggestion-item" data-value="${p}">${p}</div>`).join(''); 
            provinceSuggestions.classList.add('show'); 
        }

        provinceInput.addEventListener('input', function() {
            const value = this.value.toLowerCase().trim();
            if (!value) { 
                showAllProvinces(); 
                provinceValue.value = ''; 
                provinceOther.classList.remove('show'); 
                return; 
            }
            const filtered = provinces.filter(p => p.toLowerCase().includes(value) || p.replace(/üá®üá≥|üáØüáµ|üá∞üá∑|üá∏üá¨|üá≤üáæ|üáªüá≥|üá∞üá≠|üá±üá¶|üá≤üá≤/g, '').trim().toLowerCase().includes(value));
            if (filtered.length > 0) { 
                provinceSuggestions.innerHTML = filtered.map(p => `<div class="province-suggestion-item" data-value="${p}">${p}</div>`).join(''); 
                provinceSuggestions.classList.add('show'); 
            } else {
                provinceSuggestions.classList.remove('show');
            }
        });

        provinceSuggestions.addEventListener('click', function(e) {
            if (e.target.classList.contains('province-suggestion-item')) {
                const value = e.target.dataset.value;
                if (value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') { 
                    provinceInput.value = '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'; 
                    provinceValue.value = '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'; 
                    provinceOther.classList.add('show'); 
                    provinceOther.focus(); 
                } else { 
                    provinceInput.value = value; 
                    provinceValue.value = value; 
                    provinceOther.classList.remove('show'); 
                    provinceOther.value = ''; 
                }
                provinceSuggestions.classList.remove('show');
            }
        });

        document.addEventListener('click', function(e) { 
            if (!provinceInput.contains(e.target) && !provinceSuggestions.contains(e.target) && !provinceDropdownBtn.contains(e.target)) {
                provinceSuggestions.classList.remove('show'); 
            }
        });

        document.querySelectorAll('input[name="travelStatus"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const value = this.value;
                const provinceGroup = document.getElementById('provinceGroup');
                const departureDateGroup = document.querySelector('[for="departureDate"]').parentElement;
                const returnDateGroup = document.querySelector('[for="returnDate"]').parentElement;
                const companionGroup = document.querySelector('[for="companion"]').parentElement;
                const travelersGroup = document.querySelector('[for="travelers"]').parentElement;
                const vehicleGroup = document.getElementById('vehicleGroup');
                const leaveBeforeGroup = document.getElementById('leaveBeforeGroup');
                const leaveAfterGroup = document.getElementById('leaveAfterGroup');

                if (value === '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á') {
                    provinceGroup.style.display = 'none'; 
                    departureDateGroup.style.display = 'none'; 
                    returnDateGroup.style.display = 'none'; 
                    companionGroup.style.display = 'none'; 
                    travelersGroup.style.display = 'none'; 
                    vehicleGroup.style.display = 'none'; 
                    leaveBeforeGroup.style.display = 'block';
                    leaveAfterGroup.style.display = 'block';
                    
                    provinceInput.value = ''; 
                    provinceValue.value = ''; 
                    provinceOther.value = ''; 
                    provinceOther.classList.remove('show'); 
                    document.getElementById('departureDate').value = ''; 
                    document.getElementById('returnDate').value = ''; 
                    document.getElementById('companion').value = ''; 
                    document.getElementById('travelers').value = ''; 
                    document.getElementById('vehicle').value = ''; 
                    document.getElementById('leaveBefore0').checked = true;
                    document.getElementById('leaveAfter0').checked = true;
                } else if (value === '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á') { 
                    provinceGroup.style.display = 'block'; 
                    departureDateGroup.style.display = 'block'; 
                    returnDateGroup.style.display = 'block'; 
                    companionGroup.style.display = 'block'; 
                    travelersGroup.style.display = 'block'; 
                    vehicleGroup.style.display = 'block'; 
                    leaveBeforeGroup.style.display = 'block';
                    leaveAfterGroup.style.display = 'block';
                }
            });
        });

        document.getElementById('companion').addEventListener('change', function() {
            const companionOther = document.getElementById('companionOther');
            const travelersInput = document.getElementById('travelers');
            
            if (this.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') { 
                companionOther.classList.add('show'); 
                companionOther.required = true; 
            } else { 
                companionOther.classList.remove('show'); 
                companionOther.required = false; 
                companionOther.value = ''; 
            }
            
            if (this.value === '‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß') { 
                travelersInput.value = '1'; 
                travelersInput.disabled = true; 
            } else { 
                travelersInput.disabled = false; 
                if (travelersInput.value === '1') travelersInput.value = ''; 
            }
        });

        function calculateTravelDays() {
            const departureDate = document.getElementById('departureDate').value;
            const returnDate = document.getElementById('returnDate').value;
            const errorDiv = document.getElementById('dateError');
            const daysDiv = document.getElementById('travelDays');
            
            if (departureDate && returnDate) {
                const start = new Date(departureDate);
                const end = new Date(returnDate);
                
                if (end < start) { 
                    errorDiv.textContent = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ'; 
                    errorDiv.classList.add('show'); 
                    daysDiv.style.display = 'none'; 
                } else { 
                    errorDiv.classList.remove('show'); 
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; 
                    daysDiv.textContent = `üóìÔ∏è ‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á: ${diffDays} ‡∏ß‡∏±‡∏ô`; 
                    daysDiv.style.display = 'block'; 
                }
            }
        }

        document.getElementById('departureDate').addEventListener('change', calculateTravelDays);
        document.getElementById('returnDate').addEventListener('change', calculateTravelDays);

        function formatThaiDateTime(dateString) {
            if (!dateString || dateString === '-') return '-';
            try {
                let date;
                if (dateString.includes('T') || dateString.includes('Z')) {
                    const yearMatch = dateString.match(/^(\d{4})-/);
                    if (yearMatch) {
                        const year = parseInt(yearMatch[1]);
                        if (year > 2500) {
                            const christianYear = year - 543;
                            dateString = dateString.replace(/^(\d{4})/, christianYear.toString());
                        }
                    }
                    date = new Date(dateString);
                } else if (dateString.includes('/')) {
                    const parts = dateString.split(' ');
                    const dateParts = parts[0].split('/');
                    const timeParts = parts[1] ? parts[1].split(':') : ['00', '00'];
                    const day = parseInt(dateParts[0]);
                    const month = parseInt(dateParts[1]) - 1;
                    let year = parseInt(dateParts[2]);
                    if (year > 2500) year = year - 543;
                    date = new Date(year, month, day, parseInt(timeParts[0]), parseInt(timeParts[1]));
                } else {
                    date = new Date(dateString);
                }
                if (isNaN(date.getTime())) return dateString;
                const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
                const day = date.getDate();
                const month = thaiMonths[date.getMonth()];
                const year = date.getFullYear() + 543;
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${day} ${month} ${year} ${hours}:${minutes} ‡∏ô.`;
            } catch (error) { 
                return dateString; 
            }
        }

        function formatThaiDate(dateString) {
            if (!dateString || dateString === '-') return '-';
            try {
                let date;
                if (dateString.includes('T') || dateString.includes('Z')) {
                    const yearMatch = dateString.match(/^(\d{4})-/);
                    if (yearMatch) {
                        const year = parseInt(yearMatch[1]);
                        if (year > 2500) {
                            const christianYear = year - 543;
                            dateString = dateString.replace(/^(\d{4})/, christianYear.toString());
                        }
                    }
                    date = new Date(dateString);
                } else if (dateString.includes('/')) {
                    const dateParts = dateString.split('/');
                    const day = parseInt(dateParts[0]);
                    const month = parseInt(dateParts[1]) - 1;
                    let year = parseInt(dateParts[2]);
                    if (year > 2500) year = year - 543;
                    date = new Date(year, month, day);
                } else {
                    date = new Date(dateString);
                }
                if (isNaN(date.getTime())) return dateString;
                const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
                const day = date.getDate();
                const month = thaiMonths[date.getMonth()];
                const year = date.getFullYear() + 543;
                return `${day} ${month} ${year}`;
            } catch (error) { 
                return dateString; 
            }
        }

        function showSuccessModal(formData) {
            const summaryBox = document.getElementById('summaryBox');
            
            // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
            const isMobile = window.innerWidth <= 480;
            const leaveBeforeLabel = isMobile ? 'üìÖ ‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô:' : 'üìÖ ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î:';
            const leaveAfterLabel = isMobile ? 'üìÖ ‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á:' : 'üìÖ ‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î:';
            
            let summaryHTML = `<div class="summary-row"><span class="summary-label">üë§ ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</span><span class="summary-value">${formData.employeeId}</span></div><div class="summary-row"><span class="summary-label">üöó ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span><span class="summary-value">${formData.travelStatus}</span></div>`;
            if (formData.travelStatus === '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á') {
                const start = new Date(formData.departureDate);
                const end = new Date(formData.returnDate);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                summaryHTML += `<div class="summary-row"><span class="summary-label">üìç ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®:</span><span class="summary-value">${formData.province}</span></div><div class="summary-row"><span class="summary-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ:</span><span class="summary-value">${formatThaiDate(formData.departureDate)}</span></div><div class="summary-row"><span class="summary-label">üîô ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏±‡∏ö:</span><span class="summary-value">${formatThaiDate(formData.returnDate)}</span></div><div class="summary-row"><span class="summary-label">üóìÔ∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô:</span><span class="summary-value">${diffDays} ‡∏ß‡∏±‡∏ô</span></div><div class="summary-row"><span class="summary-label">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:</span><span class="summary-value">${formData.companion}</span></div><div class="summary-row"><span class="summary-label">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô:</span><span class="summary-value">${formData.travelers} ‡∏Ñ‡∏ô</span></div><div class="summary-row"><span class="summary-label">üöó ‡∏û‡∏≤‡∏´‡∏ô‡∏∞:</span><span class="summary-value">${formData.vehicle}</span></div>`;
            }
            summaryHTML += `<div class="summary-row"><span class="summary-label">${leaveBeforeLabel}</span><span class="summary-value">${formData.leaveBefore}</span></div><div class="summary-row"><span class="summary-label">${leaveAfterLabel}</span><span class="summary-value">${formData.leaveAfter}</span></div>`;
            summaryBox.innerHTML = summaryHTML; 
            document.getElementById('successModal').classList.add('show');
        }

        function closeModalAndReset() {
            document.getElementById('successModal').classList.remove('show'); 
            document.getElementById('travelForm').reset(); 
            document.getElementById('employeeInfo').classList.remove('show'); 
            document.getElementById('restOfForm').classList.remove('show'); 
            document.getElementById('travelDays').style.display = 'none'; 
            document.getElementById('companionOther').classList.remove('show'); 
            document.getElementById('provinceOther').classList.remove('show'); 
            provinceInput.value = ''; 
            provinceValue.value = ''; 
            provinceSuggestions.classList.remove('show'); 
            employeeData = null; 
            shouldDeleteOldData = false; 
            existingData = null;
            const formGroups = document.querySelectorAll('#restOfForm .form-group'); 
            formGroups.forEach(group => group.style.display = 'block');
            document.getElementById('employeeId').focus();
        }

        document.getElementById('travelForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!employeeData) { 
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); 
                return; 
            }
            const travelStatus = document.querySelector('input[name="travelStatus"]:checked');
            if (!travelStatus) { 
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'); 
                return; 
            }
            const leaveBefore = document.querySelector('input[name="leaveBefore"]:checked');
            const leaveAfter = document.querySelector('input[name="leaveAfter"]:checked');
            if (!leaveBefore) { 
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î'); 
                return; 
            }
            if (!leaveAfter) { 
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î'); 
                return; 
            }
            const travelStatusValue = travelStatus.value;
            if (travelStatusValue === '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á') {
                let province = provinceValue.value;
                if (province === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') { 
                    const otherProvince = provinceOther.value.trim(); 
                    if (!otherProvince) { 
                        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏≠‡∏∑‡πà‡∏ô‡πÜ'); 
                        provinceOther.focus(); 
                        return; 
                    } 
                    province = otherProvince; 
                }
                if (!province) { 
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ'); 
                    provinceInput.focus(); 
                    return; 
                }
                const departureDate = document.getElementById('departureDate').value;
                const returnDate = document.getElementById('returnDate').value;
                const companion = document.getElementById('companion').value;
                const travelers = document.getElementById('travelers').value;
                const vehicle = document.getElementById('vehicle').value;
                if (!departureDate || !returnDate || !companion || !travelers || !vehicle) { 
                    alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'); 
                    return; 
                }
                if (companion === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') { 
                    const companionOther = document.getElementById('companionOther').value.trim(); 
                    if (!companionOther) { 
                        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'); 
                        return; 
                    } 
                }
            }
            const submitBtn = document.getElementById('submitBtn'); 
            submitBtn.disabled = true; 
            submitBtn.innerHTML = '<span style="position: relative; z-index: 1;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>';
            const companionValue = document.getElementById('companion').value;
            let finalCompanion = companionValue; 
            if (companionValue === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                finalCompanion = document.getElementById('companionOther').value || companionValue;
            }
            let finalProvince = '-'; 
            if (travelStatusValue === '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á') { 
                if (provinceValue.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                    finalProvince = provinceOther.value || '-';
                } else {
                    finalProvince = provinceValue.value || '-';
                }
            }
            const formData = { 
                timestamp: new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' }), 
                employeeId: document.getElementById('employeeId').value.toUpperCase(), 
                division: employeeData.division, 
                department: employeeData.department, 
                workgroup: employeeData.workgroup, 
                travelStatus: travelStatusValue, 
                province: finalProvince, 
                departureDate: document.getElementById('departureDate').value || '-', 
                returnDate: document.getElementById('returnDate').value || '-', 
                companion: finalCompanion || '-', 
                travelers: document.getElementById('travelers').value || '-', 
                vehicle: document.getElementById('vehicle').value || '-', 
                leaveBefore: leaveBefore.value,
                leaveAfter: leaveAfter.value,
                isEdit: shouldDeleteOldData 
            };
            try {
                const response = await fetch(CONFIG.WEB_APP_URL, { 
                    method: 'POST', 
                    body: JSON.stringify(formData) 
                });
                const result = await response.json();
                if (result.status === 'success') { 
                    showSuccessModal(formData); 
                    shouldDeleteOldData = false; 
                    existingData = null; 
                } else {
                    throw new Error(result.message || 'Failed to save data');
                }
            } catch (error) { 
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n' + error.message + '\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n1. Apps Script ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥\n2. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÑ‡∏î‡πâ'); 
            }
            submitBtn.disabled = false; 
            submitBtn.innerHTML = '<span style="position: relative; z-index: 1;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>';
        });
    </script>
</body>
</html>
